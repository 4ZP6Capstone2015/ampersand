CONTEXT Meterkast
{- Dit is de ŽŽnversie van de Meterkast.
zo geven we straks PHPPLUG's aan:
  PHPPLUG GetPersonByNameAndAge {"ACTION=SELECT"} : I[Persoon]
ÊÊ= [ name {"PHPARG","PHPTYPE=String"} : naam
ÊÊÊÊ, age {"PHPARG","PHPTYPE=Int"} : leeftijd
ÊÊÊÊ, persoon {"PHPRETURN", "PHPTYPE=Array"} : I[Persoon]
ÊÊÊÊÊÊÊÊ= [ name : naam
ÊÊÊÊÊÊÊÊÊÊ, age Ê: leeftijd
ÊÊÊÊÊÊÊÊÊÊ, dateOfBirth : geboortedatum]
ÊÊÊÊ]
-}

SQLPLUG UserTbl : I[User]
 = [name{"SQLTYPE=Text"} : name
   ,password{"SQLTYPE=Password"} : password
   ,id{"SQLTYPE=Id"} : I
   ]

PATTERN Meterkast

name      :: User->Text.
name      :: Operation->Text.
password  :: User->Password.
owner     :: Bestand -> User PRAGMA "the owner of " " is ".
teacher   :: User * User [UNI] PRAGMA "the teacher of " " is ".
right     :: User * Operation PRAGMA "" " may exercise ".
object    :: Actie -> Bestand PRAGMA "" " is being executed on ".
user      :: Actie -> User PRAGMA "" " is being executed by user ".
right     :: Actie -> Operation PRAGMA "" " is being executed by activating ".

ENDPATTERN


  SERVICE Users : I[ONE]
   = [ Users : V[ONE*User]
        = [ nr      : I[User]
          , user    : name
          , pwd     : password
          , rechten : right
          ]
     ]

  SERVICE User : I[User]
   = [ naam    : name
     , pwd     : password
     , files   : owner~
     ]

  SERVICE Userbeheer : I[User]
   = [ naam      : name
     , pwd       : password
     , bestanden : owner~
     , studenten : teacher~
     , docent    : teacher
     , rechten   : right
     ]


  SERVICE Student : teacher;teacher~ /\ I
   = [ naam    : name
     , docentNaam  : teacher;name
     , files   : owner~
     ]

-- De volgende definitie wordt incorrect vertaald:
  SERVICE Docenten : I[ONE]
   = [ Docenten : V[ONE*User];(teacher~;teacher /\ I)
        = [ nr               : I[User]
          , user             : name
          ]
     ]

-- SERVICE Docent SERVICES Docent EDITS I[User], I[Right]
  SERVICE Docent : teacher~;teacher /\ I
   = [ naam      : name
     , bestanden : owner~
     , studenten : teacher~
        = [ naam      : name
          , bestanden : owner~
          ]
     ]

  SERVICE Bestand : I[Bestand]
   = [ eigenaar : owner
        = [ naam : name ]
     , acties   : object[Actie*Bestand]~
        = [ nr   : I[Actie]
          , user : user
          , type : right
          ]
     ]

  SERVICE Actie : I[Actie]
   = [ file     : object
     , user     : user
     , operatie : right
     ]

  SERVICE Acties : I[ONE]
   = [ Acties : V[ONE*Actie]
       = [ file     : object
         , user     : user
         , operatie : right
         ]
     ]


ENDCONTEXT
